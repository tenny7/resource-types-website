'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _regenerator=require('babel-runtime/regenerator');var _regenerator2=_interopRequireDefault(_regenerator);var _asyncToGenerator2=require('babel-runtime/helpers/asyncToGenerator');var _asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2);var _assert=require('assert');var _assert2=_interopRequireDefault(_assert);var _zlib=require('zlib');var _zlib2=_interopRequireDefault(_zlib);var _crypto=require('crypto');var _crypto2=_interopRequireDefault(_crypto);var _isStream=require('is-stream');var _isStream2=_interopRequireDefault(_isStream);var _concatStream=require('concat-stream');var _concatStream2=_interopRequireDefault(_concatStream);var _through=require('through2');var _through2=_interopRequireDefault(_through);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}exports.default=function(){var _ref=(0,_asyncToGenerator3.default)(_regenerator2.default.mark(function _callee(rstream){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var size,getSize,sum;return _regenerator2.default.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:(0,_assert2.default)(_isStream2.default.readable(rstream),'Must pass a readable stream!');size=0;getSize=(0,_through2.default)(function(chunk,enc,cb){size+=Buffer.byteLength(chunk);cb(null,chunk);});_context.next=5;return new Promise(function(resolve,reject){var hash=_crypto2.default.createHash(opts.algorithm||'sha1').setEncoding('hex');rstream.on('error',reject);if(opts.compressed){var gunzip=_zlib2.default.createGunzip();rstream.pipe(gunzip).pipe(getSize).pipe(hash).pipe((0,_concatStream2.default)(resolve));}else{rstream.pipe(getSize).pipe(hash).pipe((0,_concatStream2.default)(resolve));}});case 5:sum=_context.sent;return _context.abrupt('return',{sum:sum,size:size});case 7:case'end':return _context.stop();}}},_callee,this);}));return function(_x,_x2){return _ref.apply(this,arguments);};}();